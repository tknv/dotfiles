# vim: set ft=muttrc
# Paths ----------------------------------------------
set folder           = ~/mail               # mailbox location
set alias_file       = ~/.mutt/alias         # where to store aliases
set header_cache     = ~/.mutt/cache/headers # where to store headers
set message_cachedir = ~/.mutt/cache/bodies  # where to store bodies
set certificate_file = ~/.mutt/certificates  # where to store certs
set mailcap_path     = ~/.mutt/mailcap       # entries for filetypes
set tmpdir           = ~/.mutt/temp          # where to keep temp files
set sig_on_top       = yes
set signature        = ~/.mutt/sign          # my signature file
# Account Settings ----------------------------------
set mbox_type    = Maildir
set spoolfile    = "+extreme/Inbox" #Default inbox.
set mbox         = "+extreme/Archive"
set postponed    = "+extreme/Drafts"
set recall      = yes
# Editor Settings -------------------------------------
set editor	     = "vim -c \"set spell spelllang=en\""
# set editor=email-editor
# macro compose B ":set editor=text2mime-markdown.pl<enter>E:set editor=email-editor<enter>a/tmp/html-markdown-alternative.html<enter>^Du"
# How to use spell checker
# ]s — move to the next mispelled word
# [s — move to the previous mispelled word
# zg — add a word to the dictionary
# zug — undo the addition of a word to the dictionary
# z= — view spelling suggestions for a mispelled word
set trash		     = "+extreme/Deleted\ Items"
# set index_format = "%4C %Z %D %-15.15L (%2e) %s"
set index_format = "%4C %Z %d %-15.15L (%2e) %s"
set beep_new     = yes
set copy         = yes
set query_command	="lbdbq '%s'" # how to query the exchange ldap database bind editor Ctrl+T
# Mailboxes to show in the sidebar.
mailboxes +extreme/Inbox \
          +extreme/Inbox/\.Action \
          +extreme/Inbox/\.Hold \
          +extreme/Inbox/\.Done \
          +extreme/Inbox/\.HR \
          +extreme/Inbox/\.HR/\.training \
          +extreme/Inbox/\.HR/\.transition \
          +extreme/Inbox/\.HR/\.performance \
		  +extreme/Inbox/\.IT-issue \
          +extreme/Inbox/\.ProductInfo \
          +extreme/Archive \
          +extreme/Sent \
		  +extreme/Junk \
		  +extreme/Deleted\ Items \
          +extreme/Drafts
fcc-hook ~A "+extreme/Archive" # Saves copies of outgoing mail to "Archive" folder
# Notmuch setting ----------------------------------
macro index,Pager <F8> \
"<enter-command>set my_old_pipe_decode=\$pipe_decode my_old_wait_key=\$wait_key nopipe_decode nowait_key<enter>\
<shell-escape>notmuch-mutt -r --prompt search<enter>\
<change-folder-readonly>`echo ${XDG_CACHE_HOME:-$HOME/.cache}/notmuch/mutt/results`<enter>\
<enter-command>set pipe_decode=\$my_old_pipe_decode wait_key=\$my_old_wait_key<enter>" \
      "notmuch: search mail"

#macro index <F9> \
#"<enter-command>set my_old_pipe_decode=\$pipe_decode my_old_wait_key=\$wait_key nopipe_decode nowait_key<enter>\
#<pipe-message>notmuch-mutt -r thread<enter>\
#<change-folder-readonly>`echo ${XDG_CACHE_HOME:-$HOME/.cache}/notmuch/mutt/results`<enter>\
#<enter-command>set pipe_decode=\$my_old_pipe_decode wait_key=\$my_old_wait_key<enter>" \
#      "notmuch: reconstruct thread"

#macro index <F6> \
#"<enter-command>set my_old_pipe_decode=\$pipe_decode my_old_wait_key=\$wait_key nopipe_decode nowait_key<enter>\
#<pipe-message>notmuch-mutt tag -- -inbox<enter>\
#<enter-command>set pipe_decode=\$my_old_pipe_decode wait_key=\$my_old_wait_key<enter>" \
#      "notmuch: remove message from inbox"

# Sidebar Patch --------------------------------------
# set sidebar_delim   	= '  │'
# color sidebar_new color221 color233
set sidebar_visible 	= yes
set sidebar_width   	= 30
# Sidebar Navigation ---------------------------------
bind index,pager K  sidebar-prev
bind index,pager J  sidebar-next
bind index,pager L  sidebar-open
# bind pager \Ck  sidebar-prev
# bind pager \Cj  sidebar-next
# bind pager \Cl  sidebar-open
#Status Bar ----------------------------------------
set status_chars  = " *%A"
set status_format = "───[ Folder: %f ]───[%r%m messages%?n? (%n new)?%?d? (%d to delete)?%?t? (%t tagged)? ]───%>─%?p?( %p postponed )?───"

# Sending mail ---------------------------------------
set from		="wtakanobu@extremenetworks.com"
set realname		="Takanobu Watanabe"
set use_from		="yes"
set envelope_from	="yes"
set sendmail		="/usr/bin/msmtp -a extreme"
# set sendmail		=text2mime-sendmail.pl

# Header Options -------------------------------------
ignore *                                # ignore all headers
unignore from: to: cc: date: subject:   # show only these
unhdr_order *                           # some distros order things by default
hdr_order from: to: cc: date: subject:  # and in this order

# Set Header -----------------------------------------
set hdrs = yes
set edit_headers = yes
my_hdr X-Priority: 1 (Highest)
my_hdr X-MSMail-Priority: High

# Index View Options ---------------------------------
set date_format = "%m/%d %I:%M"
set sort = reverse-threads
set sort_aux = date-received
set uncollapse_jump                        # don't collapse on an         unread message
set sort_re                                # thread based on regex
#set reply_regexp = "^(([Rr][Ee]?(\[[0-9]+\])?: *)?(\[[^]]+\] *)?)*"

# Index Key Bindings ---------------------------------
bind index gg       first-entry
bind index G        last-entry
bind index R        group-reply
bind index <space>  collapse-thread
# toggle flagged messages
macro index .i  "<limit>(~N|~F)<Enter>"  "view new/flag" # .i will show all new/flagged
macro index .a "<limit>~A<Enter>" "view all" # .a will show all again
bind index   \t          next-unread
bind pager   \t          next-unread
bind index  ,\t      previous-unread
bind pager  ,\t      previous-unread
bind pager <Return> next-line
# bind index <Return> select-entry 
bind index <Return> display-message 

# Sync email
macro index O "<shell-escape>mbsync extreme<enter>" "run mbsync to sync all mail"

# Saner copy/move dialogs
macro index,pager C "<copy-message>?<toggle-mailboxes>" "copy a message to a mailbox"
macro index,pager \em ":set confirmappend=no delete=yes<enter><tag-thread><tag-prefix-cond><save-message>?<toggle-mailboxes>" "move a all thread message to a mailbox"
macro index,Pager \eCA ":set confirmappend=no delete=yes<enter><tag-thread><tag-prefix-cond><save-message>+extreme/Archive<enter><sync-mailbox>:set confirmappend=yes delete=ask-yes<enter>"  "Archive all in thread"
macro index,Pager \eca ":set confirmappend=no delete=yes<enter><save-message>+extreme/Archive<enter><sync-mailbox>:set confirmappend=yes delete=ask-yes<enter>" "Archive message"
# Filter by hand --------------------------------------
# move to action
macro index,Pager \eAC ":set confirmappend=no delete=yes<enter><tag-thread><tag-prefix-cond><save-message>+extreme/Inbox/\.Action<enter><sync-mailbox>:set confirmappend=yes delete=ask-yes<enter>"  "move a all thread message to Action"
macro index,Pager \eac ":set confirmappend=no delete=yes<enter><save-message>+extreme/Inbox/\.Action<enter><sync-mailbox>:set confirmappend=yes delete=ask-yes<enter>" "move to Action"
# move to hold
macro index,Pager \eHO ":set confirmappend=no delete=yes<enter><tag-thread><tag-prefix-cond><save-message>+extreme/Inbox/\.Hold<enter><sync-mailbox>:set confirmappend=yes delete=ask-yes<enter>"  "move a all thread message to Hold"
macro index,Pager \eho ":set confirmappend=no delete=yes<enter><save-message>+extreme/Inbox/\.Hold<enter><sync-mailbox>:set confirmappend=yes delete=ask-yes<enter>" "move to Hold"
# move to done
macro index,Pager \eDO ":set confirmappend=no delete=yes<enter><tag-thread><tag-prefix-cond><save-message>+extreme/Inbox/\.Done<enter><sync-mailbox>:set confirmappend=yes delete=ask-yes<enter>"  "move a all thread message to Done"
macro index,Pager \edo ":set confirmappend=no delete=yes<enter><save-message>+extreme/Inbox/\.Done<enter><sync-mailbox>:set confirmappend=yes delete=ask-yes<enter>" "move to Done"
# to view
macro index       -   "<limit>all\n" "show all messages (undo limit)"
macro index       \C_  "<tag-pattern>~N<enter><tag-prefix-cond>N<untag-pattern>~T<enter>" "mark all as read"

# Pager View Options ---------------------------------
set pager_index_lines = 10 # number of index lines to show
set pager_context = 3      # number of context lines to show
set pager_stop             # don't go to next message automatically
set menu_scroll            # scroll in menus
set tilde                  # show tildes like in vim
unset markers              # no ugly plus signs
set quote_regexp = "^( {0,4}[>|:#%]| {0,4}[a-z0-9]+[>|]+)+"

# Pager Key Bindings ---------------------------------
bind pager k  previous-line
bind pager j  next-line
bind pager gg top
bind pager G  bottom
bind pager R  group-reply

# Compose View Options -------------------------------
set realname = "Takanobu Watanabe"   # who am i?
set envelope_from                    # which from?
set sig_dashes                       # dashes before sig
set askcc                            # ask for CC:
set fcc_attach                       # save attachments with the body
unset mime_forward                   # forward attachments as part of body
set forward_format = "Fwd: %s"       # format of subject when forwarding
set forward_decode                   # decode when forwarding
set reply_to                         # reply to Reply to: field
set reverse_name                     # reply as whomever it was to
set include                          # include message in replies
set forward_quote                    # include message in forwards
set indent_str="> "
set check_new=yes
set timeout=15
set mail_check=5
set crypt_use_gpgme=no

# Automatically open evil HTML ---------------------
auto_view text/html

# Color quoted set
color quoted0   blue        default
color quoted1   green       default
color quoted2   red         default
color quoted3   blue        default
color quoted4   green       default
color quoted5   red         default
color quoted6   blue        default

# Color scheme -------------------------------------
color index      brightyellow  default ~N # New
color attachment magenta          white
color error      brightwhite   red
color hdrdefault brightwhite   magenta
color header     brightyellow  black   ^Subject        # except for `Subject:'.
color header     black         red     ^(X-Spam-Status:\ Yes|X-Virus-Report:)
color header     black         red     ^Newsgroups:.*, # cross-posted
color header     black         green   ^Followup-To:   # followup header
mono  header     bold ^(From|Subject):
color indicator  brightwhite   magenta
color markers    brightcyan    default
color message    white         default
color normal     white         default
color search     magenta          default
color signature  magenta         default
color status     brightwhite   magenta
color tilde      brightmagenta default
color tree       brightmagenta default

# Various smilies and the like ---------------------
color body brightgreen black <[Ee]?[Bb]?[Gg]>
color body brightgreen black <[Bb][Gg]>
color body brightgreen black ' [;:]-*[)>(<|]'

# URLs ---------------------------------------------
# color body brightblue black (http|ftp|news|telnet|finger):\/\/([^[:space:]]+)
color body magenta black (http|ftp|news|telnet|finger):\/\/([^[:space:]]+)
#color body brightblue black mailto:[-a-z_0-9.]+@[-a-z_0-9.]+
color body magenta black mailto:[-a-z_0-9.]+@[-a-z_0-9.]+
mono body bold (http|ftp|news|telnet|finger):\/\/([^[:space:]]+)
mono body bold mailto:[-a-z_0-9.]+@[-a-z_0-9.]+

# email addresses ----------------------------------
# color body brightblue black [-a-z_0-9.%$]+@[-a-z_0-9.]+\\.[-a-z][-a-z]+
color body magenta black [-a-z_0-9.%$]+@[-a-z_0-9.]+\\.[-a-z][-a-z]+
mono body bold [-a-z_0-9.%$]+@[-a-z_0-9.]+\\.[-a-z][-a-z]+
